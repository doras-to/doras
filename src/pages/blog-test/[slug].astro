---
import Layout from "@/layouts/MDLayout.astro";
import Container from "@/components/container.astro";
const { slug } = Astro.params;

let res = await fetch(`https://cms.doras.to/wp-json/wp/v2/posts?slug=${slug}`);
let [post] = await res.json();

// Fetch the category name
let categoryRes = await fetch(`https://cms.doras.to/wp-json/wp/v2/categories/${post.categories[0]}`);
let category = await categoryRes.json();

// Fetch the author name
let authorRes = await fetch(`https://cms.doras.to/wp-json/wp/v2/users/${post.author}`);
let author = await authorRes.json();

// The getStaticPaths() is required for static Astro sites.
// If using SSR, you will not need this function.
export async function getStaticPaths() {
    let data = await fetch("`https://cms.doras.to/wp-json/wp/v2/posts");
    let posts = await data.json();

    return posts.map((post) => ({
        params: { slug: post.slug },
        props: { post: post }
    }));
}
---

<Layout title={post.title.rendered}>
    <Container>
        <div class="mx-auto max-w-3xl text-center mt-6">
            <article>
                <span class="text-primary-500 uppercase tracking-wider text-sm font-black">{category.name}</span>
                <h1 class="text-3xl lg:text-4xl font-bold lg:tracking-tight mt-1 lg:leading-tight text-surface-900" set:html={post.title.rendered} />
                <div class="flex gap-2 mt-3 items-center justify-center text-sm flex-wrap md:flex-nowrap">
                    <span class="text-surface-600">By {author.name}</span>
                    <span class="text-surface-600 hidden md:block">•</span>
                    <!-- <div class="w-full md:w-auto flex flex-wrap justify-center gap-3">
                        {entry.data.tags.map((tag) => <span class="text-sm text-primary-500">#{tag}</span>)}
                    </div> -->
                    <a href="/blog" class="font-bold text-primary-500 transition">← Back to Blog</a>
                </div>
                <Fragment set:html={post.content.rendered} />
            </article>
        </div>
    </Container>
</Layout>
